{% extends "index.html" %}
{% load crispy_forms_tags %}

{% block content %}
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <h2>Properties</h2>

    <br>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#filterModal">View Filters</button>
    <a class="btn btn-outline-secondary" href="{% url 'properties' %}" role="button">Clear Filters</a>
    <br><br>

    <!-- Below line sourced from: https://bootstrapcreative.com/pattern/responsive-card-deck-example/ -->
    <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5">

    {% for property in filter.qs %}
        <div class="card" style="width: 18rem;">
            <div class="card-body">
                <h5 class="card-title">{{property.title}}</h5>
                <h6 class="card-subtitle mb-2 text-muted">${{property.total_price}}</h6>
                <text class="card-text">{{property.address}}</text><br>
                <text class="card-text">Distance: {{property.distance}} mi</text><br>
                <text class="card-text">Free parking: {{property.parking}}</text><br>
                <text class="card-text">Furnished: {{property.furnished}}</text><br>
                <a href="{% url 'property' property.id %}" class="card-link">View Property</a>
                <form method = "post">{% csrf_token %}
                    <input type="hidden" name="property" value={{property.id}}>
                    <input type="submit" name = "myFav" value = "Favorite" class="button">
                </form>
            </div>
        </div>
    {% endfor %}
    </div>


    <div class="container">
        <br>
        <h2>Your Favorite Properties</h2>
        {% for property in model %}
        {% if property.favorite == True %}
            <div class="card" style="width: 18rem;">
            <div class="card-body">
                <h5 class="card-title">{{property.title}}</h5>
                <h6 class="card-subtitle mb-2 text-muted">${{property.total_price}}</h6>
                <text class="card-text">{{property.address}}</text><br>
                <text class="card-text">Distance: {{property.distance}} mi</text><br>
                <text class="card-text">Free parking: {{property.parking}}</text><br>
                <text class="card-text">Furnished: {{property.furnished}}</text><br>
                <a href="{% url 'property' property.id %}" class="card-link">View Property</a>
            </div>
            </div>
        {% endif %}
        {% endfor %}
        </div>


    </div>
    
    <script>
        var PropertyListPage = {
            init: function() {
            this.$container = $('.property-container');
            this.render();
            this.bindEvents();
        },

        render: function() {

        },

        bindEvents: function() {
            $('.btn-favorite', this.$container).on('click', function(e) {
                console.log('Hola');
                e.preventDefault();

                var self = $(this);
                var url = $(this).attr('href');
                $.getJSON(url, function(result) {
                    if (result.success) {
                            $('.glyphicon-star', self).toggleClass('active');
                        }
                    });

                    return false;
                });
            }
        };

        $(document).ready(function() {
            PropertyListPage.init();
        });
    </script>


<!--Property Filter & Sorting Modal -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle">Sort & Filter Properties</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Clear"></button>
      </div>
      <div class="modal-body">
        <form method="GET">
          {{ filter.form|crispy }}
          <button type="submit" class="btn btn-primary">Search</button>
          <input class="btn btn-secondary" type="reset" value="Reset">
          <button type="button" class="btn btn-danger" data-bs-dismiss="modal">Close</button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %}
